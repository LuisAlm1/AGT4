<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ViralPost AI{% endblock %} | Genera Im치genes Virales</title>
    <meta name="description" content="Genera im치genes virales profesionales para tus redes sociales con inteligencia artificial. Sube tu producto, elige un estilo y obt칠n contenido listo para publicar.">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fdf4ff',
                            100: '#fae8ff',
                            200: '#f5d0fe',
                            300: '#f0abfc',
                            400: '#e879f9',
                            500: '#d946ef',
                            600: '#c026d3',
                            700: '#a21caf',
                            800: '#86198f',
                            900: '#701a75',
                        }
                    }
                }
            }
        }
    </script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .style-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .style-card {
            transition: all 0.3s ease;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Selector de Idioma/Pa칤s (flotante) -->
    <div id="langSelectorContainer" class="fixed top-20 right-4 z-50">
        <div class="relative">
            <button onclick="toggleLangMenu()" id="langToggle"
                    class="flex items-center space-x-2 bg-white shadow-lg rounded-full px-4 py-2 hover:shadow-xl transition text-sm font-medium text-gray-700">
                <span id="langDisplay">游쓇릖 ES</span>
                <i class="fas fa-chevron-down text-xs"></i>
            </button>
            <div id="langMenu" class="hidden absolute right-0 mt-2 bg-white rounded-xl shadow-xl overflow-hidden min-w-[160px]">
                <button onclick="changeLang('es', 'MXN')"
                        class="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 text-sm">
                    <span>游쓇릖</span>
                    <span>Espa침ol (MXN)</span>
                </button>
                <button onclick="changeLang('en', 'USD')"
                        class="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 text-sm border-t">
                    <span>游쥟릖</span>
                    <span>English (USD)</span>
                </button>
            </div>
        </div>
    </div>

    {% block content %}{% endblock %}

    <!-- i18n Script -->
    <script src="/viralpost/static/js/i18n.js"></script>

    <!-- Scripts globales -->
    <script>
        // Constantes de la API
        const API_BASE = '/viralpost/api';

        // Toggle del men칰 de idioma
        function toggleLangMenu() {
            const menu = document.getElementById('langMenu');
            menu.classList.toggle('hidden');
        }

        // Cambiar idioma
        function changeLang(lang, currency) {
            // Guardar preferencia
            localStorage.setItem('viralpost_lang', lang);
            localStorage.setItem('viralpost_currency', currency);

            // Actualizar I18n si existe
            if (window.I18n) {
                I18n.currentLang = lang;
                I18n.currentCurrency = currency;
            }

            toggleLangMenu();

            // Recargar para aplicar cambios en toda la p치gina
            window.location.reload();
        }

        // Cerrar men칰 al hacer clic fuera
        document.addEventListener('click', (e) => {
            const container = document.getElementById('langSelectorContainer');
            const menu = document.getElementById('langMenu');
            if (container && menu && !container.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });

        // Helpers de autenticaci칩n
        const Auth = {
            getToken() {
                return localStorage.getItem('viralpost_token');
            },
            setToken(token) {
                localStorage.setItem('viralpost_token', token);
            },
            removeToken() {
                localStorage.removeItem('viralpost_token');
                localStorage.removeItem('viralpost_user');
            },
            getUser() {
                const user = localStorage.getItem('viralpost_user');
                return user ? JSON.parse(user) : null;
            },
            setUser(user) {
                localStorage.setItem('viralpost_user', JSON.stringify(user));
            },
            isLoggedIn() {
                return !!this.getToken();
            },
            logout() {
                this.removeToken();
                window.location.href = '/viralpost';
            }
        };

        // Helper para fetch con auth
        async function apiFetch(endpoint, options = {}) {
            const token = Auth.getToken();
            const headers = {
                ...options.headers
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            if (!(options.body instanceof FormData)) {
                headers['Content-Type'] = 'application/json';
            }

            const response = await fetch(`${API_BASE}${endpoint}`, {
                ...options,
                headers
            });

            if (response.status === 401) {
                Auth.logout();
                return;
            }

            return response;
        }

        // Formatear n칰mero
        function formatNumber(num) {
            const locale = window.I18n ? I18n.getRegionInfo().locale : 'es-MX';
            return new Intl.NumberFormat(locale).format(num);
        }

        // Formatear precio (usa i18n si est치 disponible)
        function formatPrice(amountMXN) {
            if (window.I18n) {
                return I18n.formatPrice(amountMXN);
            }
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN'
            }).format(amountMXN);
        }

        // Mostrar notificaci칩n
        function showNotification(message, type = 'success') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
